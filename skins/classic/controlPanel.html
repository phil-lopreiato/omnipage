[[IF MESSAGE]]<div class="ui-state-highlight ui-corner-all" style="padding:10px;"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>{{message}}</div>[[END IF]]

<!-- HTML WYSIWYG - jHTMLArea: http://jhtmlarea.codeplex.com/ -->

<script type="text/javascript">
 $(function() {
 $("#message").htmlarea({
	loaded: function(){
		// this.showHTMLView();
	}
 });
 });
</script>
<script type="text/javascript">
$(document).ready(function(){
	//accordion
	$(".accordion").accordion({active:false});
	$("#permissions").hide();
	$('#logList').hide();
	$('#oldLogs').click(function(){$('#logList').toggle()});
	$(".showPermissions").click(function(){$("#permissions").toggle()});
	$("#dialog").dialog({autoOpen:false,show:"slide",hide:"slide"});
	$("#archLog").click(function(){
		var conf = confirm('Are you sure you want to archive the logs?', 'Confirmation');
		if(conf)
			window.location = "/omni/actions/logArch.php?cpanel";
	});
	$("#pageSelect").change(function(){
		$("#confirmDel").attr("checked",false);
	});

    $("#pageEditSelect").change(function(){
        // load page details
        $.post("/omni/ajax/pageInfo.php", {pageId:$("#pageEditSelect").val()}, function(data){
            var info = $.parseJSON(data);
            $("#newTitle").val(info['title']);
            $("#newParent").val(info['parentId']);
            $("#newMenuOrder").val(info['order']);
            $("#newRedirectBox").val(info['redirect']);
            $("#newInherent").attr("checked", info['inheritPermissions']==1);
            $("#newPrivate").attr("checked", info['private']==1);
            $("#newHideBox").attr("checked", info['hide']==1);
        });
    });

	$("#delForm").submit(function(){
		if($("#confirmDel").attr("checked"))
			return true;
		else{
			$('#dialog').html('You need to confirm the deletion!').dialog('open');
			return false;
			}
	});


    $("#userSelect").change(function(){
        $("#confirmPermission").attr("checked", false);
        $("#userId").val("");
    });

    $("#confirmPermission").change(function(){
        if($("#userSelect").val().length == 0) return;

        $.post("/omni/ajax/getUserId.php", {username:$("#userSelect").val()}, function(data){
            $("#userId").val(data);
        });
    });

	$("#specialPermission").submit(function(){
		if(!$("#confirmPermission").attr("checked")){
			alert("You need to confirm the operation.");
			return false;
		}else if(!$("input[@name='permission']:checked").val()){
            alert("You need to select an operation.");
            return false;
        }else if(!$("#userId").val()){
            alert("You need to enter a username.");
            return false;
        }else if($("#permissionPage").val() <= 0){
            alert("You must select a page");
            return false;
        }else if($("#permissionType").val() == -1){
            alert("You must select a permission type");
            return false;
        }
        return true;
    });



});

function getPageMods(id){
	$.get("/omni/modules/mod_controlPanel/history.php",{mode:'pageHistory',page:id},function(data){
		$('#pageInfo').html(data);
		$('.modHistoryLink').click(function(){
			var foo = $(this).attr('id').split("_");
			var instanceId = foo[2];
			$.get("/omni/modules/mod_controlPanel/history.php",{mode:'moduleHistory',page:id,mod:instanceId},function(data){
				$('#moduleInfo').html(data);
			});
		});
		$(".restorePage").click(function(){
			$.get("/omni/modules/mod_controlPanel/history.php",{mode:'restorePage',page:id},function(data){
				alert(data);
				$('#moduleInfo').html("");
				$('#pageInfo').html("");
			});
		});
	});
}

function popup(url, width, height, name)
{
	if (!name){
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes, width=' + width);
	return false;
}
</script>
<h1>Administrator Control Panel</h1>

<div class="accordion">
<h3><a href="#">Manage Skins</a></h3>
<div>
<strong>Add a Skin</strong>
<form name="addSkin" id="addSkin" method="post" action="">
<p><label for="skinName" style="width:150px;display:inline-block;">Skin Name: <a href="#" onclick="$('#dialog').html('This is the name for the new skin').dialog('open');">?</a></label><input type="text" name="skinName" id="skinName" /></p>

<p><label for="skinPath" style="width:150px;display:inline-block;">Skin Path: <a href="#" onclick="$('#dialog').html('This is the path of the directory for the new skin. It is relative to the /omni/skins/ directory. No slashes are needed.').dialog('open');">?</a></label><input type="text" name="skinPath" id="skinPath" /></p>

<p><label for="skinParent" style="width:150px;display:inline-block;">Skin Parent: <a href="#" onclick="$('#dialog').html('This is the parent for the new skin. If the new skin does not contain a certain skin file, it will be searched for in the directory of the parent. This allows for the ghosting of skins to others.').dialog('open');">?</a></label><select name="skinParent" id="skinParent">{{skins}}</select></p>

<input type="hidden" name="mode" value="addSkin" />
<input type="submit" value="Add Skin" id="addSkinButton" />
</form>
</div>

<h3><a href="#">Create new Page</a></h3>
<div>
<form id="addPage" method="post" action="">

<p><label for="pageTitleBox" style="width:150px;display:inline-block;">Page Title: <a href="#" onclick="$('#dialog').html('This is the browser window title, url, and sitemap title. Titles can contain only letters, numbers, and spaces.').dialog('open');">?</a>
</label><input type="text" name="pageTitle" id="pageTitleBox"></p>

<p><label for="parentSelect" style="width:150px;display:inline-block;">Parent Page: <a href="#" onclick="$('#dialog').html('This is the page under which the new page can be found in the menus, site map, and through the url.').dialog('open');">?</a></label>
<select name="parent" id="parentSelect" style="min-width:150px;">

<option value='-1'></option>
<option value='0' style='font-weight:bold;'>Site Root</option>
{{children}}
</select></p>

<p><label for="redirectBox" style="width:150px;display:inline-block;">Redirect: <a href="#" onclick="$('#dialog').html('If text is entered here, when the page is clicked on, the browser will instead redirect to the url entered.').dialog('open');">?</a></label><input name="redirect" id="redirectBox"></p>

<p><label for="menuOrder" style="width:150px;display:inline-block;">Menu Order: <a href="#" onclick="$('#dialog').html('If a number between 0 and 100 is entered here, they will be displayed in the menu in order of lowest to highest.').dialog('open');">?</a></label><input name="menuOrder" id="menuOrder" value="0"/></p>

<p><label for="inherentBox" style="width:150px;display:inline-block;">Inherent Permissions: <a href="#" onclick="$('#dialog').html('This changes whether or not users who have editing/viewing permissions in parent pages will have those permissions for the new page.').dialog('open');">?</a></label><input type="checkbox" name="inherentBox" id="inherentBox"></p>

<p><label for="privateBox" style="width:150px;display:inline-block;">Private: <a href="#" onclick="$('#dialog').html('If a page is private, it can only be viewed by admins, management, and users with special permissions.').dialog('open');">?</a></label><input type="checkbox" name="privateBox" id="privateBox"></p>

<p><label for="hideBox" style="width:150px;display:inline-block;">Hide in Menu: <a href="#" onclick="$('#dialog').html('If this box is checked, it will not be displayed in the menu header on all pages.').dialog('open');">?</a></label><input type="checkbox" name="hideBox" id="hideBox" /></p>

<input type="hidden" name="mode" value="addPage">
<p><input type="submit" value="Create"></p>
</form>
</div>

<h3><a href="#">Modify an Existing Page</a></h3>
<div>
<form method="post" action="">
<p><label for="pageEditSelect" style="width:150px;display:inline-block;">Selece a Page to Edit:</label><select name="pageEditSelect" id="pageEditSelect" style="min-width:150px;">
<option value='-1'></option>
{{children}}
</select></p>

<p><label for="newTitle" style="width:150px;display:inline-block;">Page Title: <a href="#" onclick="$('#dialog').html('This is the browser window title, url, and sitemap title. Titles can contain only letters, numbers, and spaces.').dialog('open');">?</a>
</label><input type="text" name="newTitle" id="newTitle"></p>

<p><label for="newParent" style="width:150px;display:inline-block;">Parent Page: <a href="#" onclick="$('#dialog').html('This is the page under which the new page can be found in the menus, site map, and through the url.').dialog('open');">?</a></label><select name="newParent" id="newParent" style="min-width:150px;">
<option value='-1'></option>
{{children}}</select></p>

<p><label for="newMenuOrder" style="width:150px;display:inline-block;">Menu Order: <a href="#" onclick="$('#dialog').html('If a number between 0 and 100 is entered here, they will be displayed in the menu in order of lowest to highest.').dialog('open');">?</a></label><input name="newMenuOrder" id="newMenuOrder" value="0"/></p>

<p><label for="newRedirectBox" style="width:150px;display:inline-block;">Redirect: <a href="#" onclick="$('#dialog').html('If text is entered here, when the page is clicked on, the browser will instead redirect to the url entered.').dialog('open');">?</a></label><input name="newRedirect" id="newRedirectBox"></p>

<p><label for="newInherent" style="width:150px;display:inline-block;">Inherent Permissions: <a href="#" onclick="$('#dialog').html('This changes whether or not users who have editing/viewing permissions in parent pages will have those permissions for the new page.').dialog('open');">?</a></label><input type="checkbox" name="newInherent" id="newInherent"></p>

<p><label for="newPrivate" style="width:150px;display:inline-block;">Private: <a href="#" onclick="$('#dialog').html('If a page is private, it can only be viewed by admins, management, and users with special permissions.').dialog('open');">?</a></label><input type="checkbox" name="newPrivate" id="newPrivate"></p>

<p><label for="newHideBox" style="width:150px;display:inline-block;">Hide in Menu: <a href="#" onclick="$('#dialog').html('If this box is checked, it will not be displayed in the menu header on all pages.').dialog('open');">?</a></label><input type="checkbox" name="newHideBox" id="newHideBox" /></p>


<input type="hidden" name="mode" value="editPage">
<input type="submit" name="editSubmit" value="Change">

</form>
</div>

<h3><a href="#">Delete a Page</a></h3>
<div>
<form method="post" action="" id="delForm">
<p><label for="pageSelect" style="width:150px;display:inline-block;">Select Page to Delete: </label><select name="page" id="pageSelect" style="min-width:150px;">';
<option value='-1'></option>
{{children}}
</select></p>
<p><label for="confirmDel" style="width:150px;display:inline-block;">Are you sure you want to delete this page? </label><input type="checkbox" name="confirmDel" id="confirmDel">
</p>
<p><input type="hidden" name="mode" value="delPage">
<input type="submit" value="Delete"></p>
</form>
</div>

<h3><a href="#">View Page History</a></h3>
<div>
<form method="post" action="">
<label for="viewEditPage" style="width:150px;display:inline-block;">Select a Page:</label><select id="viewEditPage" name="viewEditPage" onchange="getPageMods(this.value)"><option value="0">Site Root</option>{{fullChildren}}</select>
<div name="pageInfo" id="pageInfo">
</div>
<div id="moduleInfo" name="moduleInfo">
</div>
</form>
</div>

<h3><a href="#">Create User</a></h3>
<div>
<form method="post" action="" id="createUser">
<p>Username: <input type="text" name="username" id="username" /></p>
<p>Password: <input type="password" name="password" id="password" /></p>
<p>Email: <input type="test" name="email" id="email" /></p>
<p>Admin? <input type="checkbox" name="isAdmin" id="isAdmin" /></p>

<input type="hidden" name="mode" value="addUser" />
<input type="submit" name="addUserSbmit" value="Add" />
</form>
</div>

<h3><a href="#">Special User Permissions</a></h3>
<div>
<form method="post" action="" id="specialPermission">
<fieldset>
<p><label for="addPermission" style="width:150px;display:inline-block;">Add Permissions <a href="#" onclick="$('#dialog').html('Gives the specified user special permissions on the specified page.').dialog('open');">?</a></label><input type="radio" name="permissions" value="addPermission" />
<br><label for="editPermission" style="width:150px;display:inline-block;">Modify Permissions <a href="#" onclick="$('#dialog').html('This allows you to change the permission type for a specified user on a specified page. With this option selected, \'the permission type\' attribute does not need to be selected.').dialog('open');">?</a></label><input type="radio" name="permissions" value="editPermission" />
<br><label for="delPermission" style="width:150px;display:inline-block;">Remove Permissions <a href="#" onclick="$('#dialog').html('This deletes special permissions for a specified user on a specified page.').dialog('open');">?</a></label><input type="radio" name="permissions" value="delPermission" />
</fieldset><br></p>
<p><label for="userSelect" style="width:150px;display:inline-block;">Enter Username: <a href="#" onclick="$('#dialog').html('This is the username of the user which you would like to give special permissions to.').dialog('open');">?</a></label><input type="text" name="userSelect" id="userSelect"></p>
<p><label for="permissionPage" style="width:150px;display:inline-block">Select Page: <a href="#" onclick="$('#dialog').html('These are the pages which the user will have special permissions for. If child pages of a page inherit permissions, the user will have special permissions on those pages, as well.').dialog('open');">?</a></label><select name="permissionPage" id="permissionPage" style="min-width:150px;">
<option value='-1'></option>
{{children}}</select></p>
<p><label for="permissionType" style="width:150px;display:inline-block;">Permission Type <a href="#" onclick="$('#dialog').html('Read permissions allow the user to see a page that has been marked private. Write permissions allow that user to edit that page as well as see it. This option is not necessary when deleting permissions.').dialog('open');">?</a></label><select name="permissionType" id="permissionType" style="min-width:150px;">
<option value='-1'></option>
<option value='0'>Read </option>
<option value='1'>Write</option>
</select></p>
<p><label for="confirmPermission" style="width:150px;display:inline-block;">Are you sure you want to add, modify, or delete special permissions for this user?</label><input type="checkbox" name="confirmPermission" id="confirmPermission"></p>
<input type="hidden" name="mode" value="specialPermission">
<input type="hidden" name="userId" id="userId" value="" />
<p><input type="submit" value="Submit"></p>
</form>
<br>
<a href="javascript:void(0);" class="showPermissions">Show/Hide User Permission List</a>
<div id="permissions">
{{permissions}}
</div>

</div>
<h3><a href="#">View Log</a></h3>
<div>
For interpreting or purging logs, contact webmaster.
<div style="font-family:'Courier', monospace;padding:4px;background-color:beige;height:300px; overflow-y:auto;">{{log}}</div>
<a href="javascript:void(0)" name="archLog" id="archLog">Archive Logs Now</a><br/>
<a href="javascript:void(0)" name="oldLogs" id="oldLogs">Show Old Logs</a>
<div id="oldLogs">
{{oldLogs}}
</div>
</div>

</div>
<Br/>

<br/>
